# 인사 조회 사례

## 사례 1: 주간 인사 발령 및 프로젝트 철수 현황

### 업무 요구사항

> "주마다의 인트라넷에 발령사항, 프로젝트 철수건을 추출하기 → 인원 현황 최신화"
> (출처: Requirements/인사2.md)

매주 월요일, 지난 주의 인사 변동사항(발령, 프로젝트 철수)을 조회하여 인원 현황을 업데이트해야 합니다.

### 가상의 테이블 구조

```sql
-- 직원 테이블
employees (
    emp_id INT,
    emp_name VARCHAR,
    dept_id INT,
    position VARCHAR,
    current_project_id INT,
    hire_date DATE,
    resign_date DATE
)

-- 인사 발령 이력
personnel_changes (
    change_id INT,
    emp_id INT,
    change_type VARCHAR,  -- '부서이동', '승진', '프로젝트배정' 등
    from_value VARCHAR,
    to_value VARCHAR,
    change_date DATE,
    effective_date DATE
)

-- 프로젝트
projects (
    project_id INT,
    project_name VARCHAR,
    client_name VARCHAR,
    start_date DATE,
    end_date DATE,
    status VARCHAR  -- '진행중', '완료', '철수' 등
)

-- 프로젝트 인력 배정
project_assignments (
    assignment_id INT,
    project_id INT,
    emp_id INT,
    role VARCHAR,
    assigned_date DATE,
    released_date DATE
)
```

### AI에게 질문하는 법

#### 1단계: 지난 주 인사 발령 조회

```
## 목표
지난 주(월요일~일요일)의 모든 인사 발령 사항을 조회하고 싶습니다.

## 테이블 구조
- personnel_changes:
  - change_id: 변경 ID
  - emp_id: 직원 ID
  - change_type: 변경 유형 ('부서이동', '승진', '프로젝트배정' 등)
  - from_value: 변경 전 값
  - to_value: 변경 후 값
  - change_date: 변경 기록일
  - effective_date: 발효일

- employees:
  - emp_id, emp_name, dept_id, position

## 조건
- 지난 주 월요일부터 일요일까지 발효된(effective_date) 변경사항
- 직원 이름과 함께 표시
- 발효일 순으로 정렬

SQL을 작성하고 설명해주세요.
```

#### 예상 SQL

```sql
-- 지난 주의 시작일과 종료일 계산
WITH last_week AS (
    SELECT
        DATE_TRUNC('week', CURRENT_DATE - INTERVAL '1 week') AS week_start,
        DATE_TRUNC('week', CURRENT_DATE - INTERVAL '1 week') + INTERVAL '6 days' AS week_end
)
SELECT
    pc.change_type AS 변경유형,
    e.emp_name AS 직원명,
    pc.from_value AS 변경전,
    pc.to_value AS 변경후,
    pc.effective_date AS 발효일
FROM personnel_changes pc
INNER JOIN employees e ON pc.emp_id = e.emp_id
CROSS JOIN last_week lw
WHERE pc.effective_date BETWEEN lw.week_start AND lw.week_end
ORDER BY pc.effective_date, pc.change_type;
```

#### 2단계: 프로젝트 철수 현황 추가

```
좋아요! 이제 같은 기간의 프로젝트 철수 현황도 함께 조회하고 싶습니다.

## 추가 테이블
- projects:
  - project_id, project_name, end_date, status
- project_assignments:
  - assignment_id, project_id, emp_id, released_date (프로젝트에서 빠진 날짜)

## 요구사항
- 지난 주에 철수 처리된 프로젝트 목록
- 각 프로젝트에서 빠진 인원 목록
- 프로젝트명, 직원명, 철수일 포함

위 인사 발령 쿼리와 별도로 작성해주세요.
```

#### 예상 SQL

```sql
WITH last_week AS (
    SELECT
        DATE_TRUNC('week', CURRENT_DATE - INTERVAL '1 week') AS week_start,
        DATE_TRUNC('week', CURRENT_DATE - INTERVAL '1 week') + INTERVAL '6 days' AS week_end
)
SELECT
    p.project_name AS 프로젝트명,
    p.client_name AS 고객사,
    e.emp_name AS 철수인원,
    pa.released_date AS 철수일
FROM project_assignments pa
INNER JOIN projects p ON pa.project_id = p.project_id
INNER JOIN employees e ON pa.emp_id = e.emp_id
CROSS JOIN last_week lw
WHERE pa.released_date BETWEEN lw.week_start AND lw.week_end
ORDER BY pa.released_date, p.project_name;
```

### 결과 활용

이 쿼리들을 매주 월요일에 실행하여:
1. 지난 주 인사 변동사항 파악
2. 프로젝트 인력 변동 파악
3. 인원 현황 데이터 업데이트
4. 주간 보고서 작성

---

## 사례 2: 현재 부서별/팀별 인원 현황

### 업무 요구사항

현재 시점의 정확한 인원 현황을 부서별, 팀별로 조회합니다.

### AI에게 질문하기

```
## 목표
현재 재직 중인 직원을 부서별, 팀별로 집계하고 싶습니다.

## 테이블 구조
- employees:
  - emp_id, emp_name, dept_id, team_id, position, resign_date

- departments:
  - dept_id, dept_name, parent_dept_id (본부 ID)

- teams:
  - team_id, team_name, dept_id

## 요구사항
- 재직 중인 직원만 (resign_date IS NULL)
- 본부 > 부서 > 팀 계층 구조로 표시
- 각 레벨별 인원 수
- 직급별 분포도 함께 표시

계층 구조가 복잡한데, 어떻게 쿼리를 작성해야 할까요?
```

#### 예상 SQL

```sql
-- 재직 인원 현황
SELECT
    hq.dept_name AS 본부,
    d.dept_name AS 부서,
    t.team_name AS 팀,
    e.position AS 직급,
    COUNT(*) AS 인원수
FROM employees e
LEFT JOIN teams t ON e.team_id = t.team_id
LEFT JOIN departments d ON e.dept_id = d.dept_id
LEFT JOIN departments hq ON d.parent_dept_id = hq.dept_id
WHERE e.resign_date IS NULL
GROUP BY ROLLUP(hq.dept_name, d.dept_name, t.team_name, e.position)
ORDER BY hq.dept_name, d.dept_name, t.team_name, e.position;
```

---

## 사례 3: 프로젝트별 인력 현황

### 업무 요구사항

현재 진행 중인 각 프로젝트에 몇 명이 투입되어 있는지 조회합니다.

### AI에게 질문하기

```
## 목표
현재 진행 중인 프로젝트별 투입 인력 현황을 조회하고 싶습니다.

## 테이블
- projects: project_id, project_name, start_date, end_date, status
- project_assignments: project_id, emp_id, role, assigned_date, released_date
- employees: emp_id, emp_name, dept_id, position

## 조건
- 현재 진행 중인 프로젝트 (status = '진행중')
- released_date IS NULL (현재 투입 중)
- 프로젝트명, 투입 인원 수, 역할별 분포 포함

SQL을 작성해주세요.
```

#### 예상 SQL

```sql
SELECT
    p.project_name AS 프로젝트명,
    p.client_name AS 고객사,
    COUNT(DISTINCT pa.emp_id) AS 총인원,
    COUNT(CASE WHEN pa.role = 'PL' THEN 1 END) AS PL수,
    COUNT(CASE WHEN pa.role = 'Developer' THEN 1 END) AS 개발자수,
    COUNT(CASE WHEN pa.role = 'Designer' THEN 1 END) AS 디자이너수,
    STRING_AGG(e.emp_name, ', ' ORDER BY pa.role, e.emp_name) AS 투입인력
FROM projects p
INNER JOIN project_assignments pa
    ON p.project_id = pa.project_id
    AND pa.released_date IS NULL
INNER JOIN employees e
    ON pa.emp_id = e.emp_id
WHERE p.status = '진행중'
GROUP BY p.project_id, p.project_name, p.client_name
ORDER BY 총인원 DESC;
```

---

## 실습 과제

### 과제 1
이번 달에 입사한 신입 직원 명단을 조회하고, 배정된 부서와 멘토(상사) 정보를 함께 표시하세요.

### 과제 2
다음 달에 프로젝트가 종료되는 직원 목록을 조회하여, 새로운 프로젝트 배정이 필요한 인원을 파악하세요.

### 과제 3
부서 이동이 잦은 직원(최근 1년간 2회 이상 부서 이동)을 조회하세요.

---

## 다음 단계

인사 조회를 익혔다면, 급여 관련 조회도 연습해봅시다!

👉 **[급여 조회 사례로 이동](./급여-조회-사례.md)**
