# 총무 조회 사례

## 사례 1: 자산 반출/반입 현황 조회

### 업무 요구사항

> "현재 엑셀로 관리 : 반출 반입 현황만 보유"
> (출처: Requirements/총무.md)

노트북, 모니터 등 자산의 반출/반입 현황을 데이터베이스에서 조회합니다.

### 가상의 테이블 구조

```sql
-- 자산 마스터
assets (
    asset_id INT,
    asset_name VARCHAR,
    asset_type VARCHAR,  -- '노트북', '모니터', '키보드' 등
    serial_number VARCHAR,
    purchase_date DATE,
    price DECIMAL,
    warranty_end_date DATE,
    status VARCHAR  -- '재고', '사용중', '수리중', '폐기' 등
)

-- 자산 이동 이력
asset_movements (
    movement_id INT,
    asset_id INT,
    emp_id INT,
    movement_type VARCHAR,  -- '반출', '반입'
    movement_date DATE,
    from_location VARCHAR,
    to_location VARCHAR,
    notes TEXT
)

-- 자산 배정 현황 (현재 누가 무엇을 사용 중인지)
asset_assignments (
    assignment_id INT,
    asset_id INT,
    emp_id INT,
    assigned_date DATE,
    returned_date DATE
)
```

### AI에게 질문하는 법

#### 1단계: 최근 반출/반입 현황

```
## 목표
최근 1개월간의 자산 반출/반입 현황을 조회하고 싶습니다.

## 테이블
- asset_movements:
  - movement_id, asset_id, emp_id, movement_type, movement_date, notes
- assets:
  - asset_id, asset_name, asset_type, serial_number
- employees:
  - emp_id, emp_name, dept_id

## 조건
- 최근 1개월 (현재일 기준)
- 반출/반입 구분
- 자산 정보와 직원 정보 포함
- 최신 순 정렬

SQL을 작성해주세요.
```

#### 예상 SQL

```sql
SELECT
    am.movement_type AS 구분,
    am.movement_date AS 일자,
    e.emp_name AS 직원명,
    d.dept_name AS 부서,
    a.asset_type AS 자산유형,
    a.asset_name AS 자산명,
    a.serial_number AS 시리얼번호,
    am.from_location AS 출발지,
    am.to_location AS 도착지,
    am.notes AS 비고
FROM asset_movements am
INNER JOIN assets a ON am.asset_id = a.asset_id
INNER JOIN employees e ON am.emp_id = e.emp_id
LEFT JOIN departments d ON e.dept_id = d.dept_id
WHERE am.movement_date >= CURRENT_DATE - INTERVAL '1 month'
ORDER BY am.movement_date DESC, am.movement_type;
```

#### 2단계: 미반납 자산 조회

```
좋습니다! 이제 현재 반출되어 아직 반입되지 않은 자산 목록을 조회하고 싶습니다.

## 추가 요구사항
- 현재 사용 중인 자산 (returned_date IS NULL)
- 반출된 지 얼마나 되었는지 (일 수)
- 보증 기간 만료 예정인 자산 강조

asset_assignments 테이블을 사용해주세요.
```

#### 예상 SQL

```sql
SELECT
    e.emp_name AS 사용자,
    d.dept_name AS 부서,
    a.asset_type AS 자산유형,
    a.asset_name AS 자산명,
    a.serial_number AS 시리얼번호,
    aa.assigned_date AS 반출일,
    CURRENT_DATE - aa.assigned_date AS 사용일수,
    a.warranty_end_date AS 보증만료일,
    CASE
        WHEN a.warranty_end_date < CURRENT_DATE THEN '만료'
        WHEN a.warranty_end_date < CURRENT_DATE + INTERVAL '3 months' THEN '임박'
        ELSE '정상'
    END AS 보증상태
FROM asset_assignments aa
INNER JOIN assets a ON aa.asset_id = a.asset_id
INNER JOIN employees e ON aa.emp_id = e.emp_id
LEFT JOIN departments d ON e.dept_id = d.dept_id
WHERE aa.returned_date IS NULL
ORDER BY aa.assigned_date;
```

---

## 사례 2: 부서별/팀별 자산 현황

### 업무 요구사항

> "1본부 xx팀에 자산을 모두 보고싶다."
> (출처: Requirements/총무.md)

특정 부서나 팀이 현재 사용 중인 모든 자산을 조회합니다.

### AI에게 질문하기

```
## 목표
'개발1본부' 산하의 각 팀이 현재 사용 중인 자산 목록을 조회하고 싶습니다.

## 테이블
- asset_assignments: asset_id, emp_id, assigned_date, returned_date
- assets: asset_id, asset_name, asset_type, serial_number, price
- employees: emp_id, emp_name, dept_id, team_id
- departments: dept_id, dept_name, parent_dept_id
- teams: team_id, team_name

## 요구사항
- '개발1본부' 소속 팀들
- 현재 사용 중인 자산 (returned_date IS NULL)
- 팀별, 자산 유형별 집계
- 자산 금액 합계 포함

계층 구조를 고려한 SQL을 작성해주세요.
```

#### 예상 SQL

```sql
WITH dept_hierarchy AS (
    -- 개발1본부와 그 하위 부서/팀 찾기
    SELECT dept_id, dept_name, parent_dept_id
    FROM departments
    WHERE dept_name = '개발1본부'

    UNION ALL

    SELECT d.dept_id, d.dept_name, d.parent_dept_id
    FROM departments d
    INNER JOIN dept_hierarchy dh ON d.parent_dept_id = dh.dept_id
)
SELECT
    dh.dept_name AS 부서팀,
    a.asset_type AS 자산유형,
    COUNT(DISTINCT aa.asset_id) AS 자산수량,
    SUM(a.price) AS 자산금액합계,
    STRING_AGG(DISTINCT e.emp_name || ': ' || a.asset_name, ', ') AS 상세내역
FROM dept_hierarchy dh
INNER JOIN employees e ON e.dept_id = dh.dept_id
INNER JOIN asset_assignments aa ON e.emp_id = aa.emp_id AND aa.returned_date IS NULL
INNER JOIN assets a ON aa.asset_id = a.asset_id
GROUP BY dh.dept_name, a.asset_type
ORDER BY dh.dept_name, a.asset_type;
```

---

## 사례 3: 재고 기반 예측 및 의사결정

### 업무 요구사항

> "재고기반 의사결정/예측하기"
> "내용기한 끝나가는 것 예측하기"
> "프로젝트 신규시 신규 구매 예측 등"
> (출처: Requirements/총무.md)

재고 상태를 분석하여 구매 필요성을 예측합니다.

### AI에게 질문하기

```
## 목표
다음 정보를 조회하여 구매 의사결정에 활용하고 싶습니다:
1. 현재 재고 현황 (유형별)
2. 보증 기간 임박 자산
3. 최근 3개월 반출 추이

## 테이블
- assets: asset_id, asset_type, status, warranty_end_date, purchase_date
- asset_movements: asset_id, movement_type, movement_date
- asset_assignments: asset_id, assigned_date, returned_date

## 요구사항
- 자산 유형별 통계
- 재고 vs 사용중 비율
- 보증 만료 임박 (3개월 이내)
- 월별 반출 추이

복잡하니 단계별로 나누어 작성해주세요.
```

#### 1단계: 현재 재고 현황

```sql
SELECT
    a.asset_type AS 자산유형,
    COUNT(*) AS 전체수량,
    COUNT(CASE WHEN a.status = '재고' THEN 1 END) AS 재고수량,
    COUNT(CASE WHEN a.status = '사용중' THEN 1 END) AS 사용중,
    COUNT(CASE WHEN a.status = '수리중' THEN 1 END) AS 수리중,
    ROUND(
        COUNT(CASE WHEN a.status = '재고' THEN 1 END) * 100.0 / NULLIF(COUNT(*), 0),
        1
    ) AS 재고비율
FROM assets a
WHERE a.status != '폐기'
GROUP BY a.asset_type
ORDER BY 재고비율;
```

#### 2단계: 보증 만료 임박 자산

```sql
SELECT
    a.asset_type AS 자산유형,
    COUNT(*) AS 만료임박수량,
    MIN(a.warranty_end_date) AS 가장빠른만료일,
    STRING_AGG(
        a.asset_name || '(' || a.serial_number || ')',
        ', ' ORDER BY a.warranty_end_date
    ) AS 상세목록
FROM assets a
WHERE a.warranty_end_date BETWEEN CURRENT_DATE AND CURRENT_DATE + INTERVAL '3 months'
  AND a.status != '폐기'
GROUP BY a.asset_type
ORDER BY 만료임박수량 DESC;
```

#### 3단계: 월별 반출 추이 (최근 3개월)

```sql
SELECT
    a.asset_type AS 자산유형,
    DATE_TRUNC('month', am.movement_date) AS 월,
    COUNT(*) AS 반출건수
FROM asset_movements am
INNER JOIN assets a ON am.asset_id = a.asset_id
WHERE am.movement_type = '반출'
  AND am.movement_date >= CURRENT_DATE - INTERVAL '3 months'
GROUP BY a.asset_type, DATE_TRUNC('month', am.movement_date)
ORDER BY 월 DESC, a.asset_type;
```

#### 4단계: 구매 필요성 판단 (통합 쿼리)

```sql
WITH current_inventory AS (
    -- 현재 재고
    SELECT
        asset_type,
        COUNT(CASE WHEN status = '재고' THEN 1 END) AS 재고수량
    FROM assets
    WHERE status != '폐기'
    GROUP BY asset_type
),
expiring_soon AS (
    -- 3개월 내 보증 만료
    SELECT
        asset_type,
        COUNT(*) AS 만료예정
    FROM assets
    WHERE warranty_end_date < CURRENT_DATE + INTERVAL '3 months'
      AND status != '폐기'
    GROUP BY asset_type
),
recent_usage AS (
    -- 최근 3개월 평균 월간 반출
    SELECT
        a.asset_type,
        COUNT(*) / 3.0 AS 월평균반출
    FROM asset_movements am
    INNER JOIN assets a ON am.asset_id = a.asset_id
    WHERE am.movement_type = '반출'
      AND am.movement_date >= CURRENT_DATE - INTERVAL '3 months'
    GROUP BY a.asset_type
)
SELECT
    ci.asset_type AS 자산유형,
    ci.재고수량,
    COALESCE(es.만료예정, 0) AS 만료예정,
    ROUND(COALESCE(ru.월평균반출, 0), 1) AS 월평균반출,
    CASE
        WHEN ci.재고수량 < COALESCE(ru.월평균반출, 0) THEN '구매필요'
        WHEN ci.재고수량 - COALESCE(es.만료예정, 0) < COALESCE(ru.월평균반출, 0) THEN '구매검토'
        ELSE '충분'
    END AS 구매필요성
FROM current_inventory ci
LEFT JOIN expiring_soon es ON ci.asset_type = es.asset_type
LEFT JOIN recent_usage ru ON ci.asset_type = ru.asset_type
ORDER BY
    CASE
        WHEN ci.재고수량 < COALESCE(ru.월평균반출, 0) THEN 1
        WHEN ci.재고수량 - COALESCE(es.만료예정, 0) < COALESCE(ru.월평균반출, 0) THEN 2
        ELSE 3
    END;
```

---

## 사례 4: 신규 프로젝트 자산 소요 예측

### 업무 요구사항

> "프로젝트 신규시 신규 구매 예측 등"
> (출처: Requirements/총무.md)

### AI에게 질문하기

```
## 목표
신규 프로젝트 시작 시 필요한 자산을 예측하고 싶습니다.
과거 유사 규모 프로젝트의 자산 사용 패턴을 분석해주세요.

## 테이블
- projects: project_id, project_name, team_size, start_date, end_date
- project_asset_usage: project_id, asset_type, quantity_used

## 조건
- 팀 규모별 평균 자산 사용량
- 자산 유형별 인당 평균 필요 수량

신규 프로젝트가 10명 규모라면, 어떤 자산이 몇 개 필요한지 예측하고 싶습니다.
```

#### 예상 SQL

```sql
WITH project_stats AS (
    SELECT
        p.project_id,
        p.team_size,
        pau.asset_type,
        pau.quantity_used,
        pau.quantity_used * 1.0 / NULLIF(p.team_size, 0) AS per_person
    FROM projects p
    INNER JOIN project_asset_usage pau ON p.project_id = pau.project_id
    WHERE p.end_date >= CURRENT_DATE - INTERVAL '2 years'  -- 최근 2년
)
SELECT
    asset_type AS 자산유형,
    COUNT(DISTINCT project_id) AS 참조프로젝트수,
    ROUND(AVG(per_person), 2) AS 인당평균필요량,
    ROUND(AVG(per_person) * 10, 0) AS '10명팀_예상소요',
    MIN(quantity_used) AS 최소사용량,
    MAX(quantity_used) AS 최대사용량
FROM project_stats
GROUP BY asset_type
ORDER BY 인당평균필요량 DESC;
```

---

## 실습 과제

### 과제 1
특정 자산(예: 노트북)의 평균 사용 기간을 계산하고, 교체 주기를 예측하세요.

### 과제 2
부서별 자산 보유 비용을 계산하고, 예산 대비 사용률을 조회하세요.

### 과제 3
분실 또는 파손이 잦은 자산 유형을 분석하고, 해당 자산의 추가 구매 필요성을 판단하세요.

---

## 학습 완료!

축하합니다! 🎉

인사, 급여, 총무 영역의 실무 데이터 조회를 모두 익혔습니다.
이제 실제 업무에 SQL과 AI를 적용할 준비가 되었습니다.

## 다음 단계

1. **실제 데이터베이스 접속**: 회사 DB에 연결하여 실전 연습
2. **정기 보고서 자동화**: 자주 사용하는 쿼리를 저장하고 재사용
3. **고급 기능 학습**: 윈도우 함수, CTE, 성능 최적화 등
4. **자동화 도구 개발**: Python, Subagent 등으로 자동화 (향후)

계속 학습하고 발전하세요!
